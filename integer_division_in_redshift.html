<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Sam Zuckerman" />
        <meta name="copyright" content="Sam Zuckerman" />

<meta name="keywords" content="redshift, sql, Redshift, " />
        <title>Integer Division in Redshift: Gotcha!  · programming notes
</title>
        <link href="http://cdn-images.mailchimp.com/embedcode/slim-081711.css" rel="stylesheet" type="text/css">
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="/theme/css/style.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/css/solarizedlight.css" media="screen">
        <link rel="shortcut icon" href="/theme/images/favicon.ico" type="image/x-icon" />
        <link rel="apple-touch-icon" href="/theme/images/apple-touch-icon.png" />
        <link rel="apple-touch-icon" sizes="57x57" href="/theme/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="/theme/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="/theme/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon" sizes="144x144" href="/theme/images/apple-touch-icon-144x144.png" />
        <link rel="icon" href="/theme/images/apple-touch-icon-144x144.png" />
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-128575468-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="/"><span class=site-name>programming notes</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <!--<li ><a href="">Home</a></li>-->
                            <li ><a href="/categories.html">Categories</a></li>
                            <li ><a href="/tags.html">Tags</a></li>
                            <li ><a href="/archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page_header span10 offset2">
    <h1><a href="/integer_division_in_redshift.html"> Integer Division in Redshift: Gotcha!  </a></h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">

            <h1>What's the problem?</h1>
<h2>Background to Integer Division</h2>
<p>Usually when someone divides two numbers, which don't divide evenly, with a calculator or another software program, he expects there to be a decimal. </p>
<p>For example, if I divide 3 by 2, I would expect to see 1.5.</p>
<p>It's well known with some programming situations (like Python 2) that the answer to the above would be "1" since nothing after the decimal is preserved.</p>
<p>The following Redshift code would also return 1.</p>
<div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="mi">3</span><span class="o">/</span><span class="mi">2</span>
</pre></div>


<h2>What's the solution to get a decimal then?</h2>
<p>If you cast the values to a <code>float</code>, then everything works nicely.</p>
<p>For example, in Python 2 the following would both return 1.5:</p>
<div class="highlight"><pre><span></span><span class="mf">3.0</span><span class="o">/</span><span class="mf">2.0</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mf">1.5</span>

<span class="nb">float</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mf">1.5</span>
</pre></div>


<h1>How to solve this in Redshift:</h1>
<p>In Redshift, the answer is basically the same, you merely cast to a <code>float</code>, or <code>decimal</code>, but there's a big caveat.</p>
<p>Let's say you try the following:</p>
<div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">NUMERATOR</span><span class="p">::</span><span class="nb">DECIMAL</span><span class="o">/</span><span class="n">DENOMINATOR</span><span class="p">::</span><span class="nb">DECIMAL</span>
</pre></div>


<p>You might still have integer division! Why? Because toward the bottom of <a href="https://docs.aws.amazon.com/redshift/latest/dg/r_numeric_computations201.html">this AWS documentation on numeric computations in Redshift</a> it mentions that:</p>
<blockquote>
<p>When one of the operands in a calculation has an INTEGER data type and the other operand is DECIMAL, the INTEGER operand is implicitly cast as a DECIMAL:</p>
<ul>
<li>INT2 (SMALLINT) is cast as DECIMAL(5,0)</li>
<li>INT4 (INTEGER) is cast as DECIMAL(10,0)</li>
<li>INT8 (BIGINT) is cast as DECIMAL(19,0)</li>
</ul>
</blockquote>
<p>Basically, instead of the above, you might want to cast as:</p>
<div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">NUMERATOR</span><span class="p">::</span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">DENOMINATOR</span><span class="p">::</span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</pre></div>


<p>Or, rather, something that keeps the precision in the number. The first number after the word <code>DECIMAL</code> is the <code>precision</code>, loosely meaning, "how many numbers total in the number (including after the decimal point)" and <code>scale</code> is "how many numbers after the decimal point".</p>
<p>The above have a <code>scale</code> of 0, which essentially makes them look like an <code>INTEGER</code>; just add <code>scale</code> to the mix and you should be good to go!</p>
<blockquote>
<p><strong>Note:</strong> I've seen inconsistent results with this truncation behavior, especially when I have queries containing aggregations upon aggregations. For example, even <code>SELECT NUMERATOR::DECIMAL/DENOMINATOR::DECIMAL</code> returns as a <code>DECIMAL</code>. The main point of this post is to be able to troubleshoot what the issue might be if you think you've casted data types properly and don't want to spend too much time pulling your hair out.</p>
</blockquote>
            <aside>
            <hr/>
            <nav>
            <ul class="articles_timeline">
 
                <li class="previous_article">« <a href="/functools_reduce.html" title="Previous: What's this in functools? reduce">What's this in functools? reduce</a></li>
 
                <li class="next_article"><a href="/functools_singledispatch.html" title="Next: What's this in functools? singledispatch">What's this in functools? singledispatch</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
 
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2019-01-17T15:30:00-05:00">Jan 17, 2019</time>
 
            <h4>Last Updated</h4>
            <div class="last_updated">2019-01-17 15:30:00-05:00</div>
            <h4>Category</h4>
            <a class="category-link" href="/categories.html#Redshift-ref">Redshift</a> 
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article"> 
                <li><a href="/tags.html#redshift-ref">redshift
                    <span>5</span>
</a></li>
                <li><a href="/tags.html#sql-ref">sql
                    <span>4</span>
</a></li>
            </ul>

        </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    </body>
</html>